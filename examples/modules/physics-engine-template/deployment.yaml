apiVersion: apps/v1
kind: Deployment
metadata:
  name: physics-engine-template
  namespace: anvil-demo
  labels:
    app: physics-engine-template
spec:
  replicas: 1
  selector:
    matchLabels:
      app: physics-engine-template
  template:
    metadata:
      labels:
        app: physics-engine-template
    spec:
      containers:
        - name: physics-engine
          image: anvil/physics-engine-template:0.1.0
          imagePullPolicy: IfNotPresent
          args:
            - --listen
            - :50051
          env:
            # TODO(platform): Bind this from the resolved messaging.bus capability.
            - name: NATS_URL
              value: nats://nats.anvil-demo.svc.cluster.local:4222
          ports:
            - name: grpc
              containerPort: 50051
          readinessProbe:
            tcpSocket:
              port: 50051
            initialDelaySeconds: 2
            periodSeconds: 5
          livenessProbe:
            tcpSocket:
              port: 50051
            initialDelaySeconds: 5
            periodSeconds: 10
